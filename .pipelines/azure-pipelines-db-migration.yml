# Reference from template-project â€” not active, kept for GitHub Actions migration reference
name: "DB Migration for Fund A Scholar"

trigger: none

parameters:
  - name: environment
    displayName: Select the environment
    type: string
    default: test
    values:
      - prod
      - dev
      - test
    #   - tgs-test
    #   - tgs-dev
    #   - tgs-prod

variables:
  - ${{ if eq(parameters.environment, 'dev') }}:
      - group: dev
  - ${{ if eq(parameters.environment, 'prod') }}:
      - group: prod
  - ${{ if eq(parameters.environment, 'test') }}:
      - group: test

jobs:
  - job: RunDbMigration
    displayName: "Run DB Migration"
    pool:
      vmImage: "ubuntu-latest"
    steps:
      - script: |
          set -e
          echo "Selected environment: ${{ parameters.environment }}"
          aws lambda invoke \
            --function-name FundAScholar-${{ parameters.environment }}-DbMigration \
            --payload '{}' \
            output.json
        env:
          AWS_ACCESS_KEY_ID: $(AWS_ACCESS_KEY_ID)
          AWS_SECRET_ACCESS_KEY: $(AWS_SECRET_ACCESS_KEY)
          AWS_REGION: $(AWS_REGION)
        displayName: "Start db migration"

      - script: |
          set -e
          echo "Lambda output:"
          cat output.json
        displayName: "Display Lambda output"
