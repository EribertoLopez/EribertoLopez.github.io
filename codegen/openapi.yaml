openapi: "3.0.3"
info:
  title: Eriberto Lopez Portfolio API
  version: "0.1.0"
paths:
  /chat:
    post:
      operationId: postChat
      summary: Send a chat message (RAG)
      x-amazon-apigateway-integration:
        type: aws_proxy
        httpMethod: POST
        uri:
          Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ChatHandler.Arn}/invocations
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChatRequest'
      responses:
        '200':
          description: Chat response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatResponse'

  /health:
    get:
      operationId: getHealth
      summary: Health check
      x-amazon-apigateway-integration:
        type: aws_proxy
        httpMethod: POST
        uri:
          Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ChatHandler.Arn}/invocations
      responses:
        '200':
          description: Health status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'

  /ingest:
    post:
      operationId: postIngest
      summary: Ingest documents for RAG embeddings
      x-amazon-apigateway-integration:
        type: aws_proxy
        httpMethod: POST
        uri:
          Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ChatHandler.Arn}/invocations
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IngestRequest'
      responses:
        '200':
          description: Ingest result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IngestResponse'

components:
  schemas:
    ChatMessage:
      type: object
      properties:
        role:
          type: string
          enum: [user, assistant]
        content:
          type: string
      required: [role, content]

    ChatRequest:
      type: object
      properties:
        message:
          type: string
          maxLength: 2000
        history:
          type: array
          items:
            $ref: '#/components/schemas/ChatMessage'
      required: [message]

    ChatResponse:
      type: object
      properties:
        response:
          type: string
      required: [response]

    HealthResponse:
      type: object
      properties:
        status:
          type: string
        provider:
          type: string

    IngestDocument:
      type: object
      properties:
        path:
          type: string
        content:
          type: string
      required: [path, content]

    IngestRequest:
      type: object
      properties:
        documents:
          type: array
          items:
            $ref: '#/components/schemas/IngestDocument'
      required: [documents]

    IngestResponse:
      type: object
      properties:
        message:
          type: string
        chunks:
          type: integer
        sizeKB:
          type: integer
      required: [message, chunks, sizeKB]
